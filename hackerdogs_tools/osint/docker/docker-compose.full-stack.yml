# Full Stack Docker Compose for OSINT Tools
# This setup allows your application (running in Docker) to call
# OSINT binaries in another Docker container.

services:
  # Your Application Container (LangChain/CrewAI Agents)
  app:
    build:
      context: ../..
      dockerfile: Dockerfile  # Your app's Dockerfile
    image: hackerdogs-app:latest
    container_name: hackerdogs-app
    volumes:
      # Mount Docker socket to allow app container to control Docker
      - /var/run/docker.sock:/var/run/docker.sock
      # Mount workspace for file sharing
      - ./workspace:/workspace
      # Mount logs directory
      - ./logs:/app/logs
    environment:
      - OSINT_DOCKER_IMAGE=osint-tools:latest
      - OSINT_DOCKER_CONTAINER=osint-tools
      - OSINT_DOCKER_RUNTIME=docker
      - OSINT_WORKSPACE=/workspace
    depends_on:
      - osint-tools
    networks:
      - osint-network
    restart: unless-stopped

  # OSINT Binaries Container
  osint-tools:
    build:
      context: .
      dockerfile: Dockerfile
    image: osint-tools:latest
    container_name: osint-tools
    volumes:
      # Shared workspace for input/output files
      - ./workspace:/workspace
      # Results directory
      - ./results:/results
    environment:
      - OSINT_WORKSPACE=/workspace
      - OSINT_RESULTS=/results
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 1G
    networks:
      - osint-network
    # Keep container running
    command: tail -f /dev/null
    restart: unless-stopped

networks:
  osint-network:
    driver: bridge

# Volumes (optional - for persistent data)
volumes:
  workspace:
  results:

